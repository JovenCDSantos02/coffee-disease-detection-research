<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <link rel="manifest" href="{{ url_for('serve_static', path='manifest.json') }}">
    <link rel="stylesheet" href="{{ url_for('serve_static', path='assets/css/nav-admin.css') }}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            padding: 2rem;
            min-height: 100vh;
            background-image: linear-gradient(135deg, #1E90FF, #00BFFF); 
        }

        .body {
            width: 90%;
            margin: 1rem auto 0;
            background-color: #FFFFFF;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
        }

        h1 {
            margin-bottom: 1.5rem;
            color: #333; /* Dark text color */
        }

        table {
            width: 100%;
            border-collapse: collapse; /* Remove space between table cells */
            margin-bottom: 1.5rem; /* Space below table */
        }

        th {
            background-color: #1E90FF; /* Header color */
            color: white; /* White text for header */
            padding: 0.75rem; /* Padding for header cells */
            text-align: left; /* Align text to the left */
        }

        tr:nth-child(even) {
            background-color: #00BFFF; /* Light blue for even rows */
            color: white; /* White text for even rows */
        }

        tr:nth-child(odd) {
            background-color: white; /* White for odd rows */
            color: #333; /* Dark text for odd rows */
        }

        td {
            padding: 0.75rem;
            text-align: left; /* Align text to the left */
            border-bottom: 1px solid #ccc; /* Light border for table rows */
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-transform: uppercase; 
            font-weight: bold; 
            width: 40%;
            height: 40px; 
            display: inline-block; 
        }

        .btn-primary {
            background-color: #007bff; 
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-danger {
            background-color: #dc3545; 
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333; /* Darker red on hover */
        }

        .btn-success {
            background-color: #28a745; /* Green button */
            color: white;
        }

        .btn-success:hover {
            background-color: #218838; /* Darker green on hover */
        }

        .modal {
    display: none; /* Initially hidden */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Dark overlay */
    justify-content: center;
    align-items: center;
    z-index: 1000; /* Make sure it's above other elements */
}

.modal-dialog {
    background-color: white; 
    padding: 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    width: 400px; /* Fixed width for a cleaner look */
    max-width: 90%; /* Responsive max width */
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e0e0e0; /* Light gray border */
    margin-bottom: 1rem; 
}

.modal-title {
    font-size: 1.5rem;
    color: #007bff; /* Blue title color */
}

.btn-close {
    cursor: pointer;
    font-size: 1.25rem; 
    color: #007bff; /* Blue close button */
    transition: color 0.3s ease;
}

.btn-close:hover {
    color: #0056b3; /* Darker blue on hover */
}

.modal-body {
    color: #333; /* Dark text color for body */
}

.form-label {
    font-weight: bold; /* Bold labels for emphasis */
    color: #0056b3; /* Darker blue for labels */
    margin-bottom: 0.5rem; /* Space between label and input */
}

.form-control {
    width: 100%;
    padding: 0.5rem; /* Consistent padding */
    border: 1px solid #ccc; /* Light border */
    border-radius: 0.25rem; /* Rounded corners */
    transition: border-color 0.3s ease;
}

.form-control:focus {
    border-color: #28a745; /* Green border on focus */
    outline: none; /* Remove default outline */
    box-shadow: 0 0 5px rgba(40, 167, 69, 0.5); /* Green shadow */
}

.btn-success {
    background-color: #28a745; /* Green button */
    color: white;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%; /* Full width button */
}

.btn-success:hover {
    background-color: #218838; /* Darker green on hover */
}

/* Additional styles for the modal body spacing */
.mb-3 {
    margin-bottom: 1rem; /* Bottom margin for spacing between inputs */
}

    </style>
</head>
<body>
        <div class="circle-menu" onclick="toggleMenu()">
            <img src="{{ url_for('serve_static', path='assets/images/menu-icon.png') }}" alt="Menu">
        </div>
        
        <div class="nav" id="navMenu">
            {% if session.get('position') == 'Supervisor' %}
                <div class="menu-item"><a href="/tools.html">User</a></div>
                <div class="menu-item"><a href="/admin.html">User Management</a></div>
                <div class="menu-item"><a href="/recordedResults.html">Recorded Results</a></div>
            {% endif %}
            <div class="menu-item"><a href="/logout">Logout</a></div>
        </div>
        
        <div class="body">
            <h1>User Management</h1>
            
            <table>
                <thead>
                    <tr>
                        <th>Account ID</th>
                        <th>Affiliation</th>
                        <th>Position</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for account in accounts %}
                    <tr>
                        <td>{{ account['account-id'] }}</td>
                        <td>{{ account['affiliation'] }}</td>
                        <td>{{ account['position'] }}</td>
                        <td>
                            <button class="btn btn-primary" onclick="openEditModal('{{ account['account-id'] }}', '{{ account['password'] }}', '{{ account['affiliation'] }}', '{{ account['position'] }}')">Edit</button>
                            <form action="/delete_user/{{ account['account-id'] }}" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</button>
                            </form>                            
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <button class="btn btn-success" onclick="openModal('addUserModal')">Add New User</button>

            <!-- Add User Modal -->
            <div class="modal" id="addUserModal">
                <div class="modal-dialog">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New User</h5>
                        <span class="btn-close" onclick="closeModal('addUserModal')">X</span>
                    </div>
                    <div class="modal-body">
                        <form action="/add_user" method="POST">
                            <div class="mb-3">
                                <label for="account-id" class="form-label">Account ID:</label>
                                <input type="text" class="form-control" name="account-id" required>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Password:</label>
                                <input type="password" class="form-control" name="password" required>
                            </div>
                            <div class="mb-3">
                                <label for="affiliation" class="form-label">Affiliation:</label>
                                <select class="form-control" name="affiliation" required>
                                    <option value="" disabled selected>Select Affiliation</option>
                                    <option value="San Mateo">San Mateo</option>
                                    <option value="San Juan">San Juan</option>
                                    <option value="San Pablo">San Pablo</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="position" class="form-label">Position:</label>
                                <select class="form-control" name="position" required>
                                    <option value="Farmer">Farmer</option>
                                    <option value="Supervisor">Supervisor</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-success">Add User</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Edit User Modal -->
            <div class="modal" id="editUserModal">
                <div class="modal-dialog">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit User</h5>
                        <span class="btn-close" onclick="closeModal('editUserModal')">X</span>
                    </div>
                    <div class="modal-body">
                        <form id="editUserForm" method="POST">
                            <div class="mb-3">
                                <label for="password" class="form-label">Password:</label>
                                <input type="text" class="form-control" name="password" id="editPassword" required>
                            </div>
                            <div class="mb-3">
                                <label for="affiliation" class="form-label">Affiliation:</label>
                                <select class="form-control" name="affiliation" id="editAffiliation" required>
                                    <option value="" disabled>Select Affiliation</option>
                                    <option value="San Mateo">San Mateo</option>
                                    <option value="San Juan">San Juan</option>
                                    <option value="San Pablo">San Pablo</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="position" class="form-label">Position:</label>
                                <select class="form-control" name="position" id="editPosition" required>
                                    <option value="Farmer">Farmer</option>
                                    <option value="Supervisor">Supervisor</option>
                                </select>
                            </div>
                            <input type="hidden" name="account-id" id="editAccountId">
                            <button type="submit" class="btn btn-success">Update User</button>
                        </form>
                    </div>
                </div>
            </div>
    </div>
    <div class="download-circle" style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: #1E90FF; display: flex; align-items: center; justify-content: center; cursor: pointer;">
        <img src="{{ url_for('serve_static', path='assets/images/download-icon-white.png') }}" alt="Download" style="width: 30px; height: 30px;" onclick="downloadApp()">
    </div>
    <script src="{{ url_for('serve_static', path='assets/js/circle-menu.js') }}"></script> 
    <script src="{{ url_for('serve_static', path='assets/js/app.js') }}"></script>
    <script>
        function openModal(modalId) {
            document.getElementById(modalId).style.display = "flex"; // Display modal as flex
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none"; // Hide modal
        }

        function openEditModal(accountId, password, affiliation, position) {
            document.getElementById('editAccountId').value = accountId;
            document.getElementById('editPassword').value = password;
            document.getElementById('editAffiliation').value = affiliation;
            document.getElementById('editPosition').value = position;
            openModal('editUserModal'); // Open the edit modal
        }

        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.style.display = navMenu.style.display === 'block' ? 'none' : 'block'; // Toggle menu visibility
        }
    </script>
</body>
</html>
